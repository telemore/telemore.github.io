<!DOCTYPE html>
<html lang="{{ page.lang | default: 'en' }}">
{% include head.html %}
<body>

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5SKZ39ZN"
                  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

{% include navbar.html %}
{{ content }}

<!-- Refined GDPR Cookie Consent Banner -->
<div id="cookie-banner" style="position: fixed; bottom: 16px; right: 16px; width: 360px; background: white; color: #444; border-radius: 6px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); z-index: 9999; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; font-size: 13px; line-height: 1.4; overflow: hidden;">
    <div style="padding: 14px 16px 12px;">
        <div style="display: flex; align-items: center; margin-bottom: 8px;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="margin-right: 8px;">
                <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 4c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2zm0 14c-2.2 0-4-1.8-4-4 0-1.1.9-2 2-2h4c1.1 0 2 .9 2 2 0 2.2-1.8 4-4 4z" fill="#4285F4"/>
            </svg>
            <span style="font-weight: 600; font-size: 14px;">Cookie Notice</span>
        </div>
        <p style="margin: 0 0 12px; color: #555;">
            We use cookies to improve your experience and analyze site usage.
        </p>
        <div style="display: flex; justify-content: flex-end; gap: 8px;">
            <button onclick="acceptNecessaryCookies()" style="background: transparent; border: 1px solid #dadce0; color: #555; font-size: 12px; font-weight: 500; padding: 6px 12px; border-radius: 4px; cursor: pointer; transition: background-color 0.2s;">
                Accept Necessary
            </button>
            <button onclick="acceptCookies()" style="background: #4285F4; border: none; color: white; font-size: 12px; font-weight: 500; padding: 6px 12px; border-radius: 4px; cursor: pointer; transition: background-color 0.2s; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);">
                Accept All
            </button>
        </div>
        <div style="margin-top: 10px; text-align: center;">
            <button onclick="toggleDetails()" id="details-toggle" style="background: transparent; border: none; color: #4285F4; font-size: 11px; cursor: pointer; padding: 0; text-decoration: underline;">
                Cookie policy details
            </button>
        </div>
    </div>

    <div id="cookie-details" style="display: none; padding: 0 16px 14px; border-top: 1px solid #f0f0f0; margin-top: 4px; font-size: 12px;">
        <div style="margin-top: 12px;">
            <p style="margin: 0 0 8px; color: #555;">
                <strong>Necessary cookies:</strong> Enable core site functionality. Always active.
            </p>
            <p style="margin: 0; color: #555;">
                <strong>Analytics cookies:</strong> Help us improve our website by collecting anonymous usage information.
            </p>
        </div>
    </div>
</div>

<script>
    function acceptCookies() {
        document.cookie = "analytics_consent=true; path=/; max-age=31536000";
        document.getElementById("cookie-banner").style.display = "none";

        // Initialize Google Tag Manager only after consent
        gtag('consent', 'update', {
            'ad_storage': 'granted',
            'analytics_storage': 'granted'
        });
    }

    function acceptNecessaryCookies() {
        document.cookie = "necessary_consent=true; path=/; max-age=31536000";
        document.cookie = "analytics_consent=false; path=/; max-age=31536000";
        document.getElementById("cookie-banner").style.display = "none";

        // Update Google Tag Manager consent
        gtag('consent', 'update', {
            'ad_storage': 'denied',
            'analytics_storage': 'denied'
        });
    }

    function toggleDetails() {
        const detailsSection = document.getElementById("cookie-details");
        const currentDisplay = detailsSection.style.display;
        detailsSection.style.display = currentDisplay === "none" ? "block" : "none";
        document.getElementById("details-toggle").innerText = currentDisplay === "none" ? "Hide details" : "Cookie policy details";
    }

    // Check if consent was already given
    if (document.cookie.includes("analytics_consent=true") || document.cookie.includes("necessary_consent=true")) {
        document.getElementById("cookie-banner").style.display = "none";
    }
</script>

{% include footer.html %}

<!-- JavaScript -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script type="text/javascript" src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
<script type="text/javascript" src="/js/bootstrap.bundle.min.js"></script>

{{ layout.javascript }}

</body>
</html>